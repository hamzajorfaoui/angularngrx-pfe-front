
<app-portlet title="Gestion des Actualité">


    <div class="tableau" >
        <h6 style="color:#348f6cec;">Ajouter Une Actualité :</h6>
        <form  (submit)="onFormSubmit($event)">
            <dx-form id="form"
                [formData]="dataSource">
                
                <dxi-item dataField="title">
                    <dxi-validation-rule 
                            type="required">
                    </dxi-validation-rule> 
                </dxi-item>
                <dxi-item dataField="contenu" editorType="dxTextArea" 
                [editorOptions]="{height:'90'}" > 
                    <dxi-validation-rule 
                            type="required">
                    </dxi-validation-rule> 
                </dxi-item>

                <dxi-item name="show-order" dataField="filieres">
                    <dxo-label text="Choisissez les filieres :" ></dxo-label>
                    <div *dxTemplate  >
                     <div *ngFor="let dept of dataSource.dept"  style="display: inline-block;">
                        <h6>{{dept.text}} :</h6>

                        <dx-list
                        *ngIf="dept.selectedItems"
                        [items]="dept.filiere"
                        
                        [width]="200"
                        [itemDeleteMode]="deleteType"
                        [showSelectionControls]="true"
                        selectionMode="multiple"
                        [(selectedItems)]="dept.selectedItems">

                        <dxi-validation-rule 
                            type="required">
                    </dxi-validation-rule> 
                    </dx-list>
                     </div>   
                   </div>
                </dxi-item>

                <dxi-item dataField="image"  
                          editorType="dxFileUploader" 
                          [editorOptions]="{selectButtonText:'Select photo', accept:'image/*' , uploadMode:'useButton',multiple:false , onValueChanged:this.previewFile , value:this.dataSource.image}">
                    <dxo-label
                    text="Principale image"> <!-- or "left" | "center" -->
                   </dxo-label>
                </dxi-item>

                <dxi-item>
                    <div class="col-12" style="text-align: center;" *dxTemplate>
                        <div  class="border-image" *ngIf="imageprincipale.length > 0">
                        <!-- <img   src={{imageprincipale}}  class="object-fit_none"> -->
                        <dx-gallery 
                        #gallery
                        id="gallery"
                        [dataSource]="imageprincipale"
                        [height]="340"
                        [slideshowDelay]="slideshowDelay"
                        [loop]="false"
                        [showNavButtons]="false"
                        [showIndicator]="false"
                        [swipeEnabled]="false"
                        ></dx-gallery> 
                        </div>
                    </div>
                </dxi-item>

                <dxi-item dataField="OtherImages"
                          editorType="dxFileUploader" 
                          [editorOptions]="{selectButtonText:'Select photo', accept:'image/*' , uploadMode:'useButton',multiple:true , onValueChanged:this.previewFiles , value:this.dataSource.OtherImages }">
                    <dxo-label
                    text="Autres image"> 
                   </dxo-label>
                </dxi-item>

                <dxi-item >
                    <div class="col-12" style="text-align: center; justify-content: center;"  *dxTemplate>
                        <div  class="border-image" *ngIf="OtherImages.length > 0">
                        <dx-gallery 
                        #gallery
                        id="gallery"
                        [dataSource]="OtherImages"
                        [height]="340"
                        [slideshowDelay]="slideshowDelay"
                        [loop]="false"
                        [showNavButtons]="true"
                        [showIndicator]="false"
                    ></dx-gallery>    
                        </div>
                    </div>
                </dxi-item>
                
                   <dxi-item 
                   *ngIf="!loading"
                    id="buttonsubmit"
                    caption="Update"
                    itemType="button"
                    horizontalAlignment="right"
                    [buttonOptions]="buttonOptions">
                    </dxi-item> 
                    
            </dx-form>
            <div *ngIf="loading" style="width: 100%;height:30px;">
              <div class="spinner-border text-success" role="status" style="float: right;">
                <span class="sr-only">Loading...</span>
            </div>  
            </div>
            
            </form>

            <div>
                <div id="data-grid-demo">
                <h6 style="color:#348f6cec;">Liste des Actualités</h6>
                <dx-data-grid 
                #targetDataGrid
                id="gridContainer" 
                [dataSource]="Actualites"
                keyExpr="id"
                [showBorders]="true">
            
                <dxo-selection mode="single"></dxo-selection>
                <dxo-filter-row [visible]="true"></dxo-filter-row>
                <dxi-column dataField="id" [width]="70" caption="Id"></dxi-column>
                <dxi-column dataField="filiresname" caption="Filieres" [width]="120"></dxi-column>
                <dxi-column dataField="title" caption="Titre" [width]="100"></dxi-column>
                <dxi-column dataField="contenu"   ></dxi-column>
                <dxi-column dataField="created_at" [width]="130"></dxi-column>
                <dxi-column dataField="updated_at" [width]="130" ></dxi-column>

                <dxo-editing 
                            mode="popup"
                            [refreshMode]="full"
                            [allowDeleting]="true"
                            [allowUpdating]="true">
                            
                        <dxo-popup
                            title="Information d'actualité"
                            [showTitle]="true"
                            [width]="400"
                            [height]="360"
                            [position]="{ my: 'center', at: 'center', of: window }">
                        </dxo-popup>

                        <dxo-form> 
                            <dxi-item dataField="title"  [colSpan]="2">
                                <dxi-validation-rule type="required"></dxi-validation-rule>
                            </dxi-item>
                            <dxi-item dataField="contenu"  editorType="dxTextArea" 
                            [editorOptions]="{height:'90'}" [colSpan]="2" >
                                <dxi-validation-rule type="required"></dxi-validation-rule>
                               </dxi-item>      
                        </dxo-form>

                </dxo-editing>

            </dx-data-grid>
            </div>
        </div>


    </div>



</app-portlet>